<%- include('../../template/main/head', { titleWeb: 'Perfil de Usuario', cssStyle: ['css/main/navbar.css'] }) %>
<%- include('../../template/main/navbar') %>

<% 
// Colores de portada alternativos
const coverColors = [
    'bg-gradient-to-r from-cyan-400 to-blue-600',
    'bg-gradient-to-r from-purple-500 to-pink-500',
    'bg-gradient-to-r from-green-400 to-teal-500',
    'bg-gradient-to-r from-yellow-400 to-orange-500',
    'bg-gradient-to-r from-indigo-500 to-blue-800'
];
const randomColor = coverColors[Math.floor(Math.random() * coverColors.length)];
%>
<!-- DEPURACIÓN: Mostrar valores de los campos de imagen -->
<% if (user) { %>
  <div style="background:#fee; color:#900; padding:4px; font-size:12px;">
    profile_picture: <%= user.profile_picture %> | profile_cover: <%= user.profile_cover %>
  </div>
<% } %>
<section class="w-full overflow-hidden dark:bg-gray-900 pt-20"><!-- padding top para dejar espacio al navbar -->
    <div class="w-full mx-auto">
        <!-- User Cover IMAGE o color -->
        <div class="relative">
            <% if (user && user.profile_cover) { %>
                <img src="/uploads/profile/userCover/<%= user.profile_cover %>" alt="User Cover"
                    onerror="this.onerror=null;this.src='/uploads/profile/no_cover_available.png';"
                    class="w-full xl:h-[20rem] lg:h-[22rem] md:h-[16rem] sm:h-[13rem] h-[9.5rem] object-cover" />
            <% } else { %>
                <div class="w-full xl:h-[20rem] lg:h-[22rem] md:h-[16rem] sm:h-[13rem] h-[9.5rem] <%= randomColor %> flex items-center justify-center">
                    <span class="text-white text-3xl font-bold opacity-40">Sin portada</span>
                </div>
            <% } %>
            <!-- Botón editar portada -->
            <button class="absolute top-4 right-4 bg-white bg-opacity-80 hover:bg-opacity-100 text-indigo-700 font-semibold px-4 py-2 rounded-lg shadow transition flex items-center gap-2" onclick="document.getElementById('editCoverInput').click()">
                <i class="bi bi-image"></i> Editar portada
            </button>
            <form id="coverForm" action="/profile/edit-cover" method="POST" enctype="multipart/form-data" class="hidden">
                <input type="file" id="editCoverInput" name="profile_cover" accept="image/*" onchange="this.form.submit()" />
            </form>
        </div>

        <!-- User Profile Image -->
        <div class="w-full mx-auto flex justify-center relative">
            <div class="relative inline-block">
                <img src="<%= user && user.profile_picture ? ('/uploads/profile/userProfile/' + user.profile_picture) : '/uploads/profile/7e68b3ecaa05febd9949a1a1c40c825a.jpg' %>" alt="Foto de perfil"
                    onerror="this.onerror=null;this.src='/uploads/profile/7e68b3ecaa05febd9949a1a1c40c825a.jpg';"
                    class="rounded-full object-cover xl:w-[16rem] xl:h-[16rem] lg:w-[16rem] lg:h-[16rem] md:w-[12rem] md:h-[12rem] sm:w-[10rem] sm:h-[10rem] w-[8rem] h-[8rem] outline outline-2 outline-offset-2 outline-yellow-500 shadow-xl" />
                <!-- Botón editar foto perfil mejorado -->
                <label for="editProfileInput" class="absolute bottom-2 right-2 bg-white bg-opacity-80 hover:bg-opacity-100 text-indigo-700 font-semibold px-3 py-1 rounded-full shadow transition flex items-center gap-1 cursor-pointer z-10">
                    <i class="bi bi-camera"></i>
                </label>
                <form id="profilePicForm" action="/profile/edit-picture" method="POST" enctype="multipart/form-data" class="hidden">
                    <input type="file" id="editProfileInput" name="profile_picture" accept="image/*" onchange="this.form.submit()" style="display:none;" />
                </form>
            </div>
        </div>

        <div
            class="xl:w-[80%] lg:w-[90%] md:w-[94%] sm:w-[96%] w-[92%] mx-auto flex flex-col gap-4 justify-center items-center relative"
            style="z-index:0; margin-top:-2.2rem; padding-top:7rem;">
            <!-- FullName -->
            <h1 class="text-center text-gray-800 dark:text-white text-4xl font-serif"><%= user && (user.username ? user.username : user.name) %></h1>
            <!-- About -->
            <p class="w-full text-gray-700 dark:text-gray-400 text-md text-pretty sm:text-center text-justify">
                <% if (user && user.about) { %>
                    <%= user.about %>
                <% } else { %>
                    ¡Bienvenido a tu perfil! Aquí puedes ver y editar tu información personal.
                <% } %>
            </p>

            <!-- Social Links (puedes personalizar estos enlaces) -->
            <div
                class="px-2 flex rounded-sm bg-gray-200 text-gray-500 dark:bg-gray-700 dark:bg-opacity-30 dark:text-gray-700 hover:text-gray-600 hover:dark:text-gray-400">
                <a href="#"><div data-title="LinkedIn" class="p-2 hover:text-primary hover:dark:text-primary"><i class="bi bi-linkedin text-2xl"></i></div></a>
                <a href="#"><div data-title="X" class="p-2 hover:text-primary hover:dark:text-primary"><i class="bi bi-twitter-x text-2xl"></i></div></a>
                <a href="#"><div data-title="Facebook" class="p-2 hover:text-blue-500 hover:dark:text-blue-500"><i class="bi bi-facebook text-2xl"></i></div></a>
                <a href="#"><div data-title="Youtube" class="p-2 hover:text-primary hover:dark:text-primary"><i class="bi bi-youtube text-2xl"></i></div></a>
            </div>

            <!-- Cards (puedes personalizar estos datos) -->
            <div class="w-full flex gap-4 justify-center items-center mt-10">
                <div class="xl:w-1/4 xl:h-32 lg:w-1/5 lg:h-32 md:w-1/5 md:h-28 sm:w-1/3 sm:h-[5rem] w-1/3 h-[4rem] flex justify-center items-center rounded-sm text-center text-lg px-6 py-4 border-2 border-dashed border-gray-300 dark:text-white dark:border-2 dark:border-dashed dark:border-gray-700">
                    Libros: 0
                </div>
                <div class="xl:w-1/4 xl:h-32 lg:w-1/5 lg:h-32 md:w-1/5 md:h-28 sm:w-1/3 sm:h-[5rem] w-1/3 h-[4rem] flex justify-center items-center rounded-sm text-center text-lg px-6 py-4 border-2 border-dashed border-gray-300 dark:text-white dark:border-2 dark:border-dashed dark:border-gray-700">
                    Préstamos: 0
                </div>
                <div class="xl:w-1/4 xl:h-32 lg:w-1/5 lg:h-32 md:w-1/5 md:h-28 sm:w-1/3 sm:h-[5rem] w-1/3 h-[4rem] flex justify-center items-center rounded-sm text-center text-lg px-6 py-4 border-2 border-dashed border-gray-300 dark:text-white dark:border-2 dark:border-dashed dark:border-gray-700">
                    Puntos: 0
                </div>
            </div>
        </div>
    </div>
</section>

<%- include('../../template/main/footer', { jsStyle: ['js/main.js'] }) %>